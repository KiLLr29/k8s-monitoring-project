apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
  labels:
    app: grafana
data:
  node-overview.json: |
    {
      "uid": "node-overview",
      "title": "Node Overview",
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "editable": true,
      "refresh": "30s",
      "panels": [
        {
          "type": "stat",
          "title": "Nodes",
          "gridPos": {"x": 0, "y": 0, "w": 4, "h": 4},
          "targets": [{"expr": "count(kube_node_info)", "refId": "A"}]
        },
        {
          "type": "stat",
          "title": "node-exporter up",
          "gridPos": {"x": 4, "y": 0, "w": 6, "h": 4},
          "targets": [{"expr": "sum by (instance)(up{job=\"node-exporter\"})", "refId": "A"}]
        },
        {
          "type": "timeSeries",
          "title": "CPU usage (per node)",
          "gridPos": {"x": 0, "y": 4, "w": 12, "h": 8},
          "targets": [{"expr": "sum by (instance)(rate(node_cpu_seconds_total{mode!=\"idle\"}[5m]))", "refId": "A"}]
        },
        {
          "type": "timeSeries",
          "title": "Memory usage % (per node)",
          "gridPos": {"x": 0, "y": 12, "w": 12, "h": 8},
          "targets": [{"expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100", "refId": "A"}]
        },
        {
          "type": "timeSeries",
          "title": "Root FS usage % (per node)",
          "gridPos": {"x": 0, "y": 20, "w": 12, "h": 8},
          "targets": [{"expr": "(node_filesystem_size_bytes{mountpoint=\"/\",fstype!~\"tmpfs|devtmpfs\"} - node_filesystem_free_bytes{mountpoint=\"/\",fstype!~\"tmpfs|devtmpfs\"}) / node_filesystem_size_bytes{mountpoint=\"/\",fstype!~\"tmpfs|devtmpfs\"} * 100", "refId": "A"}]
        }
      ]
    }
  kube-overview.json: |
    {
      "uid": "kube-overview",
      "title": "Kubernetes Overview",
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "editable": true,
      "refresh": "30s",
      "panels": [
        {
          "type": "stat",
          "title": "Nodes",
          "gridPos": {"x": 0, "y": 0, "w": 4, "h": 4},
          "targets": [{"expr": "count(kube_node_info)", "refId": "A"}]
        },
        {
          "type": "stat",
          "title": "Pods (Running)",
          "gridPos": {"x": 4, "y": 0, "w": 4, "h": 4},
          "targets": [{"expr": "sum(kube_pod_status_phase{phase=\"Running\"})", "refId": "A"}]
        },
        {
          "type": "stat",
          "title": "Deployments available",
          "gridPos": {"x": 8, "y": 0, "w": 4, "h": 4},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available)", "refId": "A"}]
        },
        {
          "type": "timeSeries",
          "title": "API server up",
          "gridPos": {"x": 0, "y": 4, "w": 12, "h": 6},
          "targets": [{"expr": "up{job=\"apiserver\"}", "refId": "A"}]
        },
        {
          "type": "timeSeries",
          "title": "Cluster CPU usage",
          "gridPos": {"x": 0, "y": 10, "w": 12, "h": 8},
          "targets": [{"expr": "sum(rate(node_cpu_seconds_total{mode!=\"idle\"}[5m]))", "refId": "A"}]
        }
      ]
    }

